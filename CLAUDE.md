# Project Context: Salary Hazard Map (時給競争力判定ツール)

## 1. プロジェクト概要
**株式会社バリュースタッフ**（ホテル・ブライダル業界の人材派遣）の社長が、クライアント（ホテル支配人）との商談で使用する「営業支援ツール」。
提示された時給が市場相場に対して「勝てる金額（採用可能）」か「負ける金額（採用困難）」かを、47都道府県別のダッシュボードで視覚化し、単価アップ交渉の根拠とする。

## 2. 技術スタック & 制約
このプロジェクトは**「完全なポータビリティ」**と**「即時利用」**を最優先する。

- **ファイル構成:** 単一のHTMLファイル (`hourlywage.html`) のみ。
- **HTML:** Semantic HTML5。
- **CSS:** Tailwind CSS (CDN経由で読み込み)。カスタムCSSは `<style>` タグ内に最小限記述。
- **JavaScript:** Vanilla JS (ES6+)。ビルド不要、フレームワーク不要。
- **データ:** 外部APIは使用せず、JSオブジェクトとして内部に保持（オフラインでも動作させるため）。
- **画像:** 外部画像ファイルは使用しない。アイコンはSVGコードをインラインで記述。

## 3. ビジネスロジック & 判定基準
ユーザー入力値 (`inputWage`) と、各都道府県の最低賃金 (`min`) および業界別の市場相場時給 (`avg`) を用いて判定を行う。

### 変数定義
- **Base Min Wage (`min`):** 都道府県ごとの最低賃金（2024年度データ）。
- **Market Average (`avg`):** e-Stat 賃金構造基本統計調査（2019年）から取得した実データを最低賃金上昇率で補正した推定値。
  - 業界別データ（プルダウン選択）:
    - 宿泊業・飲食サービス業（産業コード83）
    - 卸売業・小売業（産業コード52）
    - 生活関連サービス業・娯楽業（産業コード87）
    - サービス業（派遣等）（産業コード101）
  - 補正式: `2024年推定時給 = 2019年実績 × (2024年最低賃金 / 2019年最低賃金)`

### 判定ステータス
1.  **ILLEGAL (違反):** `inputWage < min`
    - 表示: 黒/グレー (Slate-800)
    - 挙動: 右上に「違反」バッジ、最低賃金までの差額を表示。
2.  **DANGER (危険):** `min <= inputWage < avg`
    - 表示: 赤 (Rose-500)
    - 意味: 最低賃金は超えているが、市場相場に負けている。応募は見込めない。
3.  **WARNING (注意):** `avg <= inputWage < avg * 1.1`
    - 表示: 黄 (Amber-400)
    - 意味: 相場並み。競合と横並びで埋もれるリスクあり。
4.  **SAFE (安全):** `inputWage >= avg * 1.1`
    - 表示: 緑 (Emerald-500)
    - 意味: 相場より10%以上高く、採用競争力がある。

## 4. データ構造 (Data Schema)
`regions` 配列内にエリア定義と都道府県データを保持する。

```javascript
const regions = [
  {
    name: "エリア名 (例: 関東)",
    prefs: [
      { name: "都道府県名", min: 1163 }, // minは最低賃金(円)
      // ...
    ]
  },
  // ...
];
```

## 5. 実装済み機能
- ダークモード対応（トグルボタン、システム設定連動、LocalStorage保存）
- レスポンシブデザイン（モバイル〜デスクトップ対応）
- 4段階判定の視覚化（SAFE/WARNING/DANGER/ILLEGAL）

## 6. TODO: 最低賃金データ取得ロードマップ

現在のデータは2024年度の最低賃金をハードコーディングしている。以下のフェーズで実データ取得を実装する。

### Phase 1: 手動更新の効率化（優先度: 高）
- [ ] 現在のハードコーディングを外部JSONファイルに分離
- [ ] データ更新日時を表示する機能を追加
- [ ] 2025年度データへの更新（全国加重平均1,121円、全都道府県1,000円超え）

### Phase 2: 自動取得の実装（優先度: 中）
- [ ] e-Stat API（政府統計の総合窓口）のユーザー登録・APIキー取得
  - URL: https://www.e-stat.go.jp/api/
  - JSON/XML/CSV形式でデータ取得可能
- [ ] 最低賃金の統計表IDを特定
- [ ] fetch()でJSONデータを取得するコードを実装
- [ ] LocalStorageにキャッシュし、定期的に更新

### Phase 3: バックエンド連携（優先度: 低・オプション）
- [ ] CORSの問題を回避するため、プロキシサーバーを経由
- [ ] または、GitHub Actionsで定期的にデータを更新しJSONファイルを生成

### オープンデータソース
| ソース | URL | 形式 | 備考 |
|--------|-----|------|------|
| e-Stat API ★推奨 | https://www.e-stat.go.jp/api/ | JSON/XML/CSV | 無料登録でAPI利用可 |
| 厚生労働省 最低賃金特設サイト | https://saiteichingin.mhlw.go.jp/ | HTML | API無し、スクレイピング必要 |
| JILPT 時系列データ | https://www.jil.go.jp/kokunai/statistics/timeseries/html/g0403.html | Excel | 過去データ向け |

### 注意事項
- 最低賃金は毎年10月頃に改定される
- 発効日は都道府県により異なる（10月1日〜1月初旬）
- e-Stat APIの利用規約を確認すること

## 7. TODO: 業界相場時給データ取得（e-Stat 賃金構造基本統計調査）

### 調査結果（2026-01-28）

#### データソース: 賃金構造基本統計調査
- **調査概要**: 主要産業に雇用される労働者の賃金実態を明らかにする統計調査
- **e-Stat URL**: https://www.e-stat.go.jp/stat-search/files?tstat=000001011429
- **調査対象産業**: 宿泊業・飲食サービス業を含む16大産業

#### 短時間労働者データの構造

| データ種別 | 統計表ID | 利用可能年次 | 産業×都道府県クロス |
|-----------|----------|-------------|-------------------|
| 令和元年以前 都道府県別 | 0003084963 | 2010-2019 | ✅ 可能 |
| 令和2年以降 職種DB | 0004008680 | 2020-2023 | ❌ 不可（職種軸のみ） |

#### 重要な発見

1. **令和元年（2019年）以前のデータ**では、産業×都道府県のクロス集計がAPI経由で取得可能
   - 分類軸: 都道府県（47）、産業（17業種）、企業規模、性別
   - 表章項目: 1時間当たり所定内給与額、年間賞与、労働者数
   - URL: https://www.e-stat.go.jp/stat-search/database?statdisp_id=0003084963

2. **令和2年（2020年）以降のデータ**は、短時間労働者の都道府県別×産業別クロス集計DBが未整備
   - 職種別DBのみ利用可能（都道府県・産業の分類軸なし）
   - 個別のExcelファイルでは提供されている可能性あり

3. **令和6年（2024年）調査の短時間労働者データ**
   - 全体: 41件のデータセット
   - サブカテゴリ: 産業大分類(4件)、職種(6件)、雇用形態別(12件)、外国人労働者(1件)、企業規模5～9人(11件)、都道府県別(7件)
   - 1時間当たり賃金: 男女計1,476円、男性1,699円、女性1,387円

#### 実装方針

##### Option A: 2019年データを使用（即時実装可能）
- e-Stat API（統計表ID: 0003084963）から産業×都道府県の時給データを取得
- データは古いが、都道府県間の相対的な格差は把握可能
- 最低賃金の上昇率を加味して補正することも検討

##### Option B: 令和6年の個別Excelファイルを手動整備
- e-Statからダウンロードしたデータを手動でJSONに変換
- 都道府県別7ファイル + 産業大分類4ファイルを組み合わせ
- 産業×都道府県のクロス集計は手計算が必要になる可能性

##### Option C: 一般労働者データで代用（令和2年以降も利用可能）
- 短時間労働者ではなく一般労働者のデータを使用
- 統計表ID: 0003445758（一般_都道府県別_職種）
- 時給ではなく月給データのため換算が必要

### 次のステップ
- [ ] e-Stat APIキーを取得
- [ ] 統計表ID 0003084963 のデータ構造を詳細確認
- [ ] 宿泊業・飲食サービス業の都道府県別時給データをJSON化
- [ ] 現在の「係数方式」と「実データ方式」を選択可能にする
